<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Moving Sale - Everything Must Go!</title>
  <meta name="description" content="Browse and purchase items from our moving sale. Great deals on furniture, electronics, and more!">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <style>
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    // Lucide icons
    const Camera = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size || 24} height={props.size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>;
    const DollarSign = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size || 24} height={props.size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><line x1="12" y1="2" x2="12" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>;
    const ShoppingCart = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size || 24} height={props.size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>;
    const X = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size || 24} height={props.size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
    const Plus = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size || 24} height={props.size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
    const Trash2 = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size || 24} height={props.size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>;
    const Check = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size || 24} height={props.size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><polyline points="20 6 9 17 4 12"/></svg>;
    const Loader2 = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size || 24} height={props.size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>;
    const Tag = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size || 24} height={props.size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"/><path d="M7 7h.01"/></svg>;
    const CreditCard = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size || 24} height={props.size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>;
    const Lock = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size || 24} height={props.size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
    const AlertCircle = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size || 24} height={props.size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>;
    const Copy = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size || 24} height={props.size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>;
    const Edit3 = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size || 24} height={props.size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>;
    const Share2 = (props) => <svg xmlns="http://www.w3.org/2000/svg" width={props.size || 24} height={props.size || 24} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={props.className}><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>;

    // Stripe Checkout Component
    const StripeCheckout = ({ total, items, sellerInfo, onSuccess, onCancel }) => {
      const [cardNumber, setCardNumber] = useState('');
      const [expiry, setExpiry] = useState('');
      const [cvc, setCvc] = useState('');
      const [name, setName] = useState('');
      const [email, setEmail] = useState('');
      const [phone, setPhone] = useState('');
      const [processing, setProcessing] = useState(false);
      const [error, setError] = useState('');

      const formatCardNumber = (value) => {
        const v = value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
        const matches = v.match(/\d{4,16}/g);
        const match = (matches && matches[0]) || '';
        const parts = [];
        for (let i = 0, len = match.length; i < len; i += 4) {
          parts.push(match.substring(i, i + 4));
        }
        return parts.length ? parts.join(' ') : value;
      };

      const formatExpiry = (value) => {
        const v = value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
        if (v.length >= 2) {
          return v.substring(0, 2) + '/' + v.substring(2, 4);
        }
        return v;
      };

      const handleSubmit = async (e) => {
        e.preventDefault();
        setError('');
        setProcessing(true);

        if (!name || !email || !cardNumber || !expiry || !cvc) {
          setError('Please fill in all fields');
          setProcessing(false);
          return;
        }

        try {
          await new Promise(resolve => setTimeout(resolve, 2000));
          
          const cleanCardNumber = cardNumber.replace(/\s/g, '');
          if (cleanCardNumber === '4000000000000002') {
            setError('Your card was declined. Please try a different card.');
            setProcessing(false);
          } else {
            onSuccess({
              paymentId: 'pi_' + Math.random().toString(36).substr(2, 24),
              amount: total,
              email,
              name,
              phone,
              items: items.map(i => ({ id: i.id, title: i.title, price: i.price }))
            });
          }
        } catch (err) {
          setError('Payment failed. Please try again.');
          setProcessing(false);
        }
      };

      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
          <div className="absolute inset-0 bg-black/60" onClick={onCancel} />
          <div className="relative w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden max-h-[90vh] overflow-y-auto">
            <div className="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white">
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-2">
                  <Lock size={20} />
                  <span className="font-medium">Secure Checkout</span>
                </div>
                <button onClick={onCancel} className="p-1 hover:bg-white/20 rounded-full">
                  <X size={20} />
                </button>
              </div>
              <div className="text-3xl font-bold">${total.toFixed(2)}</div>
              <div className="text-white/80 text-sm mt-1">{items.length} item{items.length !== 1 ? 's' : ''}</div>
            </div>

            <form onSubmit={handleSubmit} className="p-6 space-y-4">
              {error && (
                <div className="flex items-center gap-2 p-3 bg-red-50 text-red-700 rounded-lg text-sm">
                  <AlertCircle size={18} />
                  {error}
                </div>
              )}

              <div className="space-y-3">
                <input type="text" placeholder="Full Name" value={name} onChange={(e) => setName(e.target.value)} className="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none" disabled={processing} />
                <input type="email" placeholder="Email Address" value={email} onChange={(e) => setEmail(e.target.value)} className="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none" disabled={processing} />
                <input type="tel" placeholder="Phone (for pickup)" value={phone} onChange={(e) => setPhone(e.target.value)} className="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none" disabled={processing} />
              </div>

              {sellerInfo.location && (
                <div className="p-3 bg-amber-50 border border-amber-200 rounded-lg">
                  <p className="text-sm text-amber-800">üìç <strong>Pickup:</strong> {sellerInfo.location}</p>
                </div>
              )}

              <div className="pt-4 border-t">
                <div className="flex items-center gap-2 mb-3">
                  <CreditCard size={18} className="text-gray-400" />
                  <span className="text-sm font-medium text-gray-700">Card Details</span>
                </div>
                <div className="space-y-3">
                  <input type="text" placeholder="1234 5678 9012 3456" value={cardNumber} onChange={(e) => setCardNumber(formatCardNumber(e.target.value))} maxLength={19} className="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none" disabled={processing} />
                  <div className="flex gap-3">
                    <input type="text" placeholder="MM/YY" value={expiry} onChange={(e) => setExpiry(formatExpiry(e.target.value))} maxLength={5} className="flex-1 px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none" disabled={processing} />
                    <input type="text" placeholder="CVC" value={cvc} onChange={(e) => setCvc(e.target.value.replace(/\D/g, '').slice(0, 4))} maxLength={4} className="w-24 px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none" disabled={processing} />
                  </div>
                </div>
              </div>

              <button type="submit" disabled={processing} className="w-full py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg font-semibold hover:from-indigo-700 hover:to-purple-700 transition disabled:opacity-50 flex items-center justify-center gap-2">
                {processing ? (<><Loader2 className="animate-spin" size={20} />Processing...</>) : (<><Lock size={18} />Pay ${total.toFixed(2)}</>)}
              </button>
              <p className="text-xs text-gray-400 text-center">üîí Test: 4242 4242 4242 4242 | Any date | Any CVC</p>
            </form>
          </div>
        </div>
      );
    };

    // Payment Success Modal
    const PaymentSuccess = ({ payment, sellerInfo, onClose }) => (
      <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
        <div className="absolute inset-0 bg-black/60" onClick={onClose} />
        <div className="relative w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden">
          <div className="p-8 text-center">
            <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
              <Check className="w-10 h-10 text-green-600" />
            </div>
            <h2 className="text-2xl font-bold text-gray-900 mb-2">Payment Successful!</h2>
            <p className="text-gray-500 mb-6">Thank you for your purchase</p>
            <div className="bg-gray-50 rounded-xl p-4 text-left mb-6">
              <div className="flex justify-between text-sm mb-2"><span className="text-gray-500">Amount</span><span className="font-semibold text-green-600">${payment.amount.toFixed(2)}</span></div>
              <div className="flex justify-between text-sm"><span className="text-gray-500">Email</span><span>{payment.email}</span></div>
            </div>
            <div className="bg-amber-50 border border-amber-200 rounded-xl p-4 text-left mb-6">
              <h4 className="font-semibold text-amber-800 mb-2">üìç Pickup Info</h4>
              <p className="text-sm text-amber-700">{sellerInfo.location || 'Seller will contact you'}</p>
              {sellerInfo.name && <p className="text-sm text-amber-700 mt-1"><strong>Seller:</strong> {sellerInfo.name}</p>}
            </div>
            <button onClick={onClose} className="w-full py-3 bg-gray-900 text-white rounded-lg font-semibold hover:bg-gray-800 transition">Done</button>
          </div>
        </div>
      </div>
    );

    // Main App
    function MovingSaleApp() {
      const [isSellerMode, setIsSellerMode] = useState(() => {
        const params = new URLSearchParams(window.location.search);
        return params.get('mode') === 'seller';
      });
      const [listings, setListings] = useState([]);
      const [cart, setCart] = useState([]);
      const [showCart, setShowCart] = useState(false);
      const [showCheckout, setShowCheckout] = useState(false);
      const [paymentSuccess, setPaymentSuccess] = useState(null);
      const [isAnalyzing, setIsAnalyzing] = useState(false);
      const [analyzingCount, setAnalyzingCount] = useState(0);
      const [showShareModal, setShowShareModal] = useState(false);
      const [copiedLink, setCopiedLink] = useState(false);
      const [orders, setOrders] = useState([]);
      const [editingId, setEditingId] = useState(null);
      const [sellerInfo, setSellerInfo] = useState({ name: '', phone: '', location: '' });

      const analyzeImage = async (imageData) => {
        try {
          const response = await fetch("https://api.anthropic.com/v1/messages", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              model: "claude-sonnet-4-20250514",
              max_tokens: 1000,
              messages: [{
                role: "user",
                content: [
                  { type: "image", source: { type: "base64", media_type: "image/jpeg", data: imageData.split(',')[1] } },
                  { type: "text", text: `Analyze this item for a moving sale. RESPOND ONLY WITH JSON:\n{"title": "Catchy title", "description": "2-3 sentences about features/condition", "category": "Furniture|Electronics|Kitchen|Clothing|Books|Decor|Sports|Tools|Other", "priceRangeLow": number, "priceRangeHigh": number, "suggestedPrice": number, "condition": "Like New|Good|Fair|Used"}` }
                ]
              }]
            })
          });
          const data = await response.json();
          let text = data.content[0].text.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
          return JSON.parse(text);
        } catch (e) {
          return { title: "Item for Sale", description: "Great condition!", category: "Other", priceRangeLow: 10, priceRangeHigh: 50, suggestedPrice: 25, condition: "Good" };
        }
      };

      const handleImageUpload = async (e) => {
        const files = Array.from(e.target.files);
        setIsAnalyzing(true);
        setAnalyzingCount(files.length);
        let completed = 0;
        
        for (const file of files) {
          const reader = new FileReader();
          reader.onload = async (event) => {
            const imageData = event.target.result;
            const analysis = await analyzeImage(imageData);
            const newListing = {
              id: Date.now() + Math.random(),
              image: imageData,
              ...analysis,
              price: analysis.suggestedPrice,
              sold: false
            };
            setListings(prev => [...prev, newListing]);
            completed++;
            if (completed >= files.length) {
              setIsAnalyzing(false);
              setAnalyzingCount(0);
            }
          };
          reader.readAsDataURL(file);
        }
      };

      const updateListing = (id, field, value) => setListings(prev => prev.map(item => item.id === id ? { ...item, [field]: value } : item));
      const deleteListing = (id) => setListings(prev => prev.filter(item => item.id !== id));
      const addToCart = (item) => { if (!cart.find(c => c.id === item.id)) setCart(prev => [...prev, item]); };
      const removeFromCart = (id) => setCart(prev => prev.filter(item => item.id !== id));
      
      const handlePaymentSuccess = (payment) => {
        const soldIds = cart.map(item => item.id);
        setListings(prev => prev.map(item => soldIds.includes(item.id) ? { ...item, sold: true } : item));
        setOrders(prev => [...prev, { ...payment, date: new Date().toISOString() }]);
        setCart([]);
        setShowCheckout(false);
        setShowCart(false);
        setPaymentSuccess(payment);
      };

      const copyBuyerLink = () => {
        navigator.clipboard.writeText(window.location.origin + window.location.pathname);
        setCopiedLink(true);
        setTimeout(() => setCopiedLink(false), 2000);
      };

      const cartTotal = cart.reduce((sum, item) => sum + item.price, 0);
      const platformFee = cartTotal > 0 ? cartTotal * 0.029 + 0.30 : 0;
      const conditionColors = { 'Like New': 'bg-green-100 text-green-800', 'Good': 'bg-blue-100 text-blue-800', 'Fair': 'bg-yellow-100 text-yellow-800', 'Used': 'bg-gray-100 text-gray-800' };
      const availableListings = listings.filter(l => !l.sold);
      const soldListings = listings.filter(l => l.sold);

      return (
        <div className="min-h-screen bg-gradient-to-br from-orange-50 to-amber-50">
          <header className="bg-white shadow-sm sticky top-0 z-40">
            <div className="max-w-6xl mx-auto px-4 py-4">
              <div className="flex items-center justify-between">
                <div>
                  <h1 className="text-2xl font-bold text-gray-900">üè† Moving Sale</h1>
                  <p className="text-sm text-gray-500">{isSellerMode ? 'Seller Dashboard' : `${availableListings.length} items available`}</p>
                </div>
                <div className="flex items-center gap-3">
                  {isSellerMode && (
                    <button onClick={() => setShowShareModal(true)} className="flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition text-sm font-medium">
                      <Share2 size={16} />Share
                    </button>
                  )}
                  <button onClick={() => setShowCart(true)} className="relative p-2 bg-orange-500 text-white rounded-full hover:bg-orange-600 transition">
                    <ShoppingCart size={20} />
                    {cart.length > 0 && <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">{cart.length}</span>}
                  </button>
                </div>
              </div>
            </div>
          </header>

          <main className="max-w-6xl mx-auto px-4 py-6">
            {isSellerMode && (
              <>
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                  <div className="bg-white p-4 rounded-xl shadow-sm"><p className="text-sm text-gray-500">Listed</p><p className="text-2xl font-bold">{availableListings.length}</p></div>
                  <div className="bg-white p-4 rounded-xl shadow-sm"><p className="text-sm text-gray-500">Sold</p><p className="text-2xl font-bold text-orange-600">{soldListings.length}</p></div>
                  <div className="bg-white p-4 rounded-xl shadow-sm"><p className="text-sm text-gray-500">Value</p><p className="text-2xl font-bold text-green-600">${availableListings.reduce((s, l) => s + l.price, 0).toFixed(0)}</p></div>
                  <div className="bg-white p-4 rounded-xl shadow-sm"><p className="text-sm text-gray-500">Revenue</p><p className="text-2xl font-bold text-purple-600">${orders.reduce((s, o) => s + o.amount, 0).toFixed(0)}</p></div>
                </div>
                <div className="mb-8">
                  <label className="block cursor-pointer">
                    <div className={`border-2 border-dashed rounded-xl p-8 text-center transition ${isAnalyzing ? 'border-orange-400 bg-orange-50' : 'border-orange-300 hover:border-orange-500 hover:bg-orange-50'}`}>
                      {isAnalyzing ? (
                        <div className="flex flex-col items-center gap-3">
                          <Loader2 className="w-12 h-12 text-orange-500 animate-spin" />
                          <p className="text-lg font-medium text-gray-700">Analyzing {analyzingCount} item{analyzingCount !== 1 ? 's' : ''}...</p>
                          <p className="text-sm text-gray-500">AI generating titles, descriptions & prices</p>
                        </div>
                      ) : (
                        <>
                          <Camera className="w-12 h-12 text-orange-400 mx-auto mb-3" />
                          <p className="text-lg font-medium text-gray-700">Drop Photos to Add Items</p>
                          <p className="text-sm text-gray-500 mt-1">AI auto-generates title, description & price</p>
                        </>
                      )}
                    </div>
                    <input type="file" accept="image/*" multiple onChange={handleImageUpload} className="hidden" disabled={isAnalyzing} />
                  </label>
                </div>
              </>
            )}

            {availableListings.length === 0 && !isAnalyzing ? (
              <div className="text-center py-16">
                <Tag className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                <p className="text-gray-500 text-lg">No items available</p>
                <p className="text-gray-400 text-sm mt-1">{isSellerMode ? 'Upload photos to create listings!' : 'Check back soon!'}</p>
              </div>
            ) : (
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {availableListings.map(item => (
                  <div key={item.id} className="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition group">
                    <div className="relative aspect-square bg-gray-100">
                      <img src={item.image} alt={item.title} className="w-full h-full object-cover" />
                      <span className={`absolute top-2 left-2 px-2 py-1 rounded-full text-xs font-medium ${conditionColors[item.condition]}`}>{item.condition}</span>
                      <span className="absolute top-2 right-2 bg-gray-900/70 text-white px-2 py-1 rounded-full text-xs">{item.category}</span>
                      {isSellerMode && <button onClick={() => deleteListing(item.id)} className="absolute bottom-2 right-2 p-2 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition"><Trash2 size={16} /></button>}
                    </div>
                    <div className="p-4">
                      {isSellerMode && editingId === item.id ? (
                        <div className="space-y-3">
                          <input type="text" value={item.title} onChange={(e) => updateListing(item.id, 'title', e.target.value)} className="w-full font-semibold border rounded px-2 py-1" />
                          <textarea value={item.description} onChange={(e) => updateListing(item.id, 'description', e.target.value)} className="w-full text-sm border rounded p-2 resize-none" rows={3} />
                          <div className="flex items-center gap-2">
                            <span>$</span>
                            <input type="number" value={item.price} onChange={(e) => updateListing(item.id, 'price', parseFloat(e.target.value) || 0)} className="w-24 border rounded px-2 py-1" />
                          </div>
                          <button onClick={() => setEditingId(null)} className="w-full py-2 bg-orange-500 text-white rounded-lg">Done</button>
                        </div>
                      ) : (
                        <>
                          <div className="flex items-start justify-between gap-2">
                            <h3 className="font-semibold text-lg leading-tight">{item.title}</h3>
                            {isSellerMode && <button onClick={() => setEditingId(item.id)} className="p-1 text-gray-400 hover:text-orange-500"><Edit3 size={16} /></button>}
                          </div>
                          <p className="text-sm text-gray-600 mt-1 line-clamp-2">{item.description}</p>
                          {isSellerMode && <p className="text-xs text-gray-400 mt-2">Suggested: ${item.priceRangeLow}-${item.priceRangeHigh}</p>}
                          <div className="mt-4 flex items-center justify-between">
                            <span className="text-2xl font-bold text-green-600">${item.price.toFixed(2)}</span>
                            {!isSellerMode && (
                              <button onClick={() => addToCart(item)} disabled={cart.find(c => c.id === item.id)} className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition ${cart.find(c => c.id === item.id) ? 'bg-green-100 text-green-700' : 'bg-orange-500 text-white hover:bg-orange-600'}`}>
                                {cart.find(c => c.id === item.id) ? <><Check size={18} />Added</> : <><Plus size={18} />Add</>}
                              </button>
                            )}
                          </div>
                        </>
                      )}
                    </div>
                  </div>
                ))}
              </div>
            )}

            {soldListings.length > 0 && (
              <div className="mt-12">
                <h2 className="text-xl font-semibold text-gray-400 mb-4">Sold ({soldListings.length})</h2>
                <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                  {soldListings.map(item => (
                    <div key={item.id} className="relative">
                      <img src={item.image} alt={item.title} className="w-full aspect-square object-cover rounded-lg grayscale opacity-60" />
                      <div className="absolute inset-0 flex items-center justify-center">
                        <span className="bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold transform -rotate-12 shadow-lg">SOLD</span>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </main>

          {showCart && (
            <div className="fixed inset-0 z-50 flex justify-end">
              <div className="absolute inset-0 bg-black/50" onClick={() => setShowCart(false)} />
              <div className="relative w-full max-w-md bg-white h-full shadow-xl flex flex-col">
                <div className="p-4 border-b flex items-center justify-between">
                  <h2 className="text-xl font-bold">Your Cart</h2>
                  <button onClick={() => setShowCart(false)} className="p-2 hover:bg-gray-100 rounded-full"><X size={20} /></button>
                </div>
                {cart.length === 0 ? (
                  <div className="flex-1 flex items-center justify-center text-gray-400"><ShoppingCart className="w-12 h-12 mx-auto mb-3" /><p>Empty</p></div>
                ) : (
                  <>
                    <div className="flex-1 overflow-y-auto p-4 space-y-3">
                      {cart.map(item => (
                        <div key={item.id} className="flex gap-3 p-3 bg-gray-50 rounded-lg">
                          <img src={item.image} alt={item.title} className="w-16 h-16 object-cover rounded" />
                          <div className="flex-1 min-w-0">
                            <h4 className="font-medium truncate">{item.title}</h4>
                            <p className="text-green-600 font-semibold">${item.price.toFixed(2)}</p>
                          </div>
                          <button onClick={() => removeFromCart(item.id)} className="p-2 text-red-500 hover:bg-red-50 rounded"><X size={18} /></button>
                        </div>
                      ))}
                    </div>
                    <div className="p-4 border-t bg-gray-50">
                      <div className="space-y-2 mb-4">
                        <div className="flex justify-between text-sm"><span className="text-gray-500">Subtotal</span><span>${cartTotal.toFixed(2)}</span></div>
                        <div className="flex justify-between text-sm"><span className="text-gray-500">Fee</span><span>${platformFee.toFixed(2)}</span></div>
                        <div className="flex justify-between text-lg font-semibold pt-2 border-t"><span>Total</span><span className="text-green-600">${(cartTotal + platformFee).toFixed(2)}</span></div>
                      </div>
                      <button onClick={() => setShowCheckout(true)} className="w-full py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg font-semibold flex items-center justify-center gap-2">
                        <CreditCard size={18} />Pay with Card
                      </button>
                    </div>
                  </>
                )}
              </div>
            </div>
          )}

          {showShareModal && (
            <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
              <div className="absolute inset-0 bg-black/50" onClick={() => setShowShareModal(false)} />
              <div className="relative w-full max-w-md bg-white rounded-xl shadow-xl p-6">
                <h2 className="text-xl font-bold mb-4">Share Your Sale</h2>
                <p className="text-gray-600 text-sm mb-4">Buyers will only see the shopping view.</p>
                <div className="flex gap-2 mb-6">
                  <input type="text" value={window.location.origin + window.location.pathname} readOnly className="flex-1 px-3 py-2 bg-gray-100 rounded-lg text-sm font-mono" />
                  <button onClick={copyBuyerLink} className={`px-4 py-2 rounded-lg font-medium flex items-center gap-2 ${copiedLink ? 'bg-green-500 text-white' : 'bg-gray-900 text-white'}`}>
                    {copiedLink ? <><Check size={16} />Copied!</> : <><Copy size={16} />Copy</>}
                  </button>
                </div>
                <div className="border-t pt-4">
                  <h3 className="font-medium mb-3">Seller Info</h3>
                  <div className="space-y-3">
                    <input type="text" placeholder="Your name" value={sellerInfo.name} onChange={(e) => setSellerInfo(prev => ({ ...prev, name: e.target.value }))} className="w-full px-3 py-2 border rounded-lg" />
                    <input type="text" placeholder="Pickup location" value={sellerInfo.location} onChange={(e) => setSellerInfo(prev => ({ ...prev, location: e.target.value }))} className="w-full px-3 py-2 border rounded-lg" />
                    <input type="tel" placeholder="Phone" value={sellerInfo.phone} onChange={(e) => setSellerInfo(prev => ({ ...prev, phone: e.target.value }))} className="w-full px-3 py-2 border rounded-lg" />
                  </div>
                </div>
                <button onClick={() => setShowShareModal(false)} className="w-full mt-6 py-2 bg-orange-500 text-white rounded-lg font-medium">Done</button>
              </div>
            </div>
          )}

          {showCheckout && <StripeCheckout total={cartTotal + platformFee} items={cart} sellerInfo={sellerInfo} onSuccess={handlePaymentSuccess} onCancel={() => setShowCheckout(false)} />}
          {paymentSuccess && <PaymentSuccess payment={paymentSuccess} sellerInfo={sellerInfo} onClose={() => setPaymentSuccess(null)} />}
          
          <button onClick={() => setIsSellerMode(!isSellerMode)} className="fixed bottom-4 left-4 px-3 py-2 bg-gray-900 text-white text-xs rounded-full shadow-lg hover:bg-gray-800">
            {isSellerMode ? 'üëÅ Buyer View' : '‚öôÔ∏è Seller Mode'}
          </button>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<MovingSaleApp />);
  </script>
</body>
</html>
